<?php

if ( !isset($_GET['checksum']) || strlen($_GET['checksum']) !== 32 ){
	$text = "________________1¶¶¶¶¶¶¶¶¶¶¶1________________\r\n
	_____________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶1____________\r\n
	__________¶¶¶¶118¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶___________\r\n
	_______8¶¶¶¶888¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8________\r\n
	______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶______\r\n
	____8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶____\r\n
	___¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶___\r\n
	__8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶__\r\n
	__¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶88881__¶¶¶¶¶¶¶__\r\n
	_¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶81___________¶¶¶¶¶¶__\r\n
	1¶¶¶¶¶111____________________________8¶¶¶¶¶¶_\r\n
	¶¶¶¶¶1___________________________1___1¶¶¶¶¶¶_\r\n
	¶¶¶¶¶8111___________________________11¶¶¶¶¶¶_\r\n
	1¶¶¶¶88111__________________________111¶¶¶¶¶_\r\n
	_¶¶¶¶1881________________________11111_¶¶¶¶¶_\r\n
	_¶¶¶¶18811_____________________¶¶¶¶¶¶8_1¶¶¶¶1\r\n
	_¶¶¶¶118¶¶¶¶81______________8¶¶¶¶¶¶¶¶¶_1¶¶¶8¶\r\n
	_8¶¶881¶¶¶¶¶¶¶¶¶1_________1¶¶¶¶811__1¶811¶¶1¶\r\n
	¶¶¶¶118¶1__18¶¶¶¶¶8118818¶¶¶88¶111¶888¶11¶¶18\r\n
	¶8¶¶11¶¶11¶¶111¶¶¶¶¶1___1¶¶¶¶1_1¶__¶¶8888¶¶8_\r\n
	_1¶¶11¶¶¶¶¶_8¶8_8¶8¶¶____8188__¶¶__¶1__18881_\r\n
	__8¶88111¶¶_8¶8__1__11___1___111_181___18811_\r\n
	__11881___181111____11_________________1881__\r\n
	__118¶81_____________8_________________1881__\r\n
	___18¶¶1__________1111_____1_11______1_188___\r\n
	___88¶¶8________88____________8¶81____188____\r\n
	______1¶1_____8¶888_11____18¶¶118¶8888888____\r\n
	_______¶¶8881¶¶818¶¶¶¶¶8_1¶¶¶8118¶¶¶¶8888____\r\n
	_______¶¶¶¶¶¶¶¶881188¶¶¶¶¶¶818¶¶¶¶¶__1888____\r\n
	_______¶888¶18¶¶¶¶¶8888¶¶¶8¶¶¶¶8_11__88¶_____\r\n
	______1¶¶8181_118¶¶¶¶¶¶¶¶¶¶¶¶8111___8¶¶______\r\n
	¶¶¶¶¶¶¶¶¶¶88¶8_1_18¶¶¶¶¶¶¶8881_____1¶8_______\r\n
	88888¶¶¶¶¶¶¶¶¶8_11118881111_______8¶¶________\r\n
	88118¶__¶¶8¶8888_1_____________18¶¶_¶¶_______\r\n
	88888¶___¶¶8818¶¶11_1_______11¶¶¶8__¶¶¶______\r\n
	¶81¶¶¶____1¶¶¶88¶¶¶88888188¶¶¶¶81__¶¶¶¶¶_____\r\n
	88¶¶¶8______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶811__1¶¶¶¶¶¶1____\r\n
	8¶¶8_________11_1¶¶¶¶¶¶¶888811__¶¶¶¶8¶¶¶¶1___\r\n
	¶¶8_______¶¶¶¶¶_____11118881__1¶¶¶¶¶¶¶¶¶¶¶___\r\n
	¶1_______¶¶¶¶¶¶______________¶¶¶¶¶¶¶¶¶8¶¶¶8__\r\n
	¶_______¶¶¶¶¶¶¶____________1¶¶¶¶¶¶¶8¶¶¶88¶¶8_\r\n
	_______1¶¶¶¶8_____________¶¶¶¶¶8¶¶¶888888¶¶¶8\r\n
	_______¶¶¶¶_____________1¶¶¶¶¶88¶¶¶¶¶88¶¶¶88¶\r\n
	______¶¶¶¶¶____________¶¶¶¶8888¶8¶88881¶8¶888\r\n
	_____¶¶¶¶¶8__________8¶¶88¶18818¶88118¶88888¶\r\n";
	die($text);
} else {
	$test = strtolower(trim($_GET['test']));
	$sec = trim($_GET['section']);
	$file = trim($_GET['res']);
	$hash = trim($_GET['checksum']);
	
	$root_path = dirname(__DIR__).'/resources/'.$test.'/'.$sec.'/';
	
	if (is_file($root_path.$file) && $hash == md5_file($root_path.$file)) {
		header("Pragma: public");
    	header("Expires: 0");
    	header("Cache-Control: must-revalidate, post-check=0, pre-check=0");
		header('Content-Description: File Transfer');
		header('Content-type: application/octet-stream');
		header('Content-disposition: attachment;filename="'.$file.'"');
		header("Content-Length: ".filesize($root_path.$file));
		header("Content-Transfer-Encoding: binary");
    	readfile($root_path.$file);
		
		http_response_code(200);
	} else {
		http_response_code(404);
		echo json_encode(array('fail'=>true));
	}
}
die;