<?php

if ( !isset($_GET['checksum']) || strlen($_GET['checksum']) !== 32 ){
	$text = '________________1¶¶¶¶¶¶¶¶¶¶¶1________________
	_____________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶1____________
	__________¶¶¶¶118¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶___________
	_______8¶¶¶¶888¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8________
	______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶______
	____8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶____
	___¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶___
	__8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶__
	__¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶88881__¶¶¶¶¶¶¶__
	_¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶81___________¶¶¶¶¶¶__
	1¶¶¶¶¶111____________________________8¶¶¶¶¶¶_
	¶¶¶¶¶1___________________________1___1¶¶¶¶¶¶_
	¶¶¶¶¶8111___________________________11¶¶¶¶¶¶_
	1¶¶¶¶88111__________________________111¶¶¶¶¶_
	_¶¶¶¶1881________________________11111_¶¶¶¶¶_
	_¶¶¶¶18811_____________________¶¶¶¶¶¶8_1¶¶¶¶1
	_¶¶¶¶118¶¶¶¶81______________8¶¶¶¶¶¶¶¶¶_1¶¶¶8¶
	_8¶¶881¶¶¶¶¶¶¶¶¶1_________1¶¶¶¶811__1¶811¶¶1¶
	¶¶¶¶118¶1__18¶¶¶¶¶8118818¶¶¶88¶111¶888¶11¶¶18
	¶8¶¶11¶¶11¶¶111¶¶¶¶¶1___1¶¶¶¶1_1¶__¶¶8888¶¶8_
	_1¶¶11¶¶¶¶¶_8¶8_8¶8¶¶____8188__¶¶__¶1__18881_
	__8¶88111¶¶_8¶8__1__11___1___111_181___18811_
	__11881___181111____11_________________1881__
	__118¶81_____________8_________________1881__
	___18¶¶1__________1111_____1_11______1_188___
	___88¶¶8________88____________8¶81____188____
	______1¶1_____8¶888_11____18¶¶118¶8888888____
	_______¶¶8881¶¶818¶¶¶¶¶8_1¶¶¶8118¶¶¶¶8888____
	_______¶¶¶¶¶¶¶¶881188¶¶¶¶¶¶818¶¶¶¶¶__1888____
	_______¶888¶18¶¶¶¶¶8888¶¶¶8¶¶¶¶8_11__88¶_____
	______1¶¶8181_118¶¶¶¶¶¶¶¶¶¶¶¶8111___8¶¶______
	¶¶¶¶¶¶¶¶¶¶88¶8_1_18¶¶¶¶¶¶¶8881_____1¶8_______
	88888¶¶¶¶¶¶¶¶¶8_11118881111_______8¶¶________
	88118¶__¶¶8¶8888_1_____________18¶¶_¶¶_______
	88888¶___¶¶8818¶¶11_1_______11¶¶¶8__¶¶¶______
	¶81¶¶¶____1¶¶¶88¶¶¶88888188¶¶¶¶81__¶¶¶¶¶_____
	88¶¶¶8______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶811__1¶¶¶¶¶¶1____
	8¶¶8_________11_1¶¶¶¶¶¶¶888811__¶¶¶¶8¶¶¶¶1___
	¶¶8_______¶¶¶¶¶_____11118881__1¶¶¶¶¶¶¶¶¶¶¶___
	¶1_______¶¶¶¶¶¶______________¶¶¶¶¶¶¶¶¶8¶¶¶8__
	¶_______¶¶¶¶¶¶¶____________1¶¶¶¶¶¶¶8¶¶¶88¶¶8_
	_______1¶¶¶¶8_____________¶¶¶¶¶8¶¶¶888888¶¶¶8
	_______¶¶¶¶_____________1¶¶¶¶¶88¶¶¶¶¶88¶¶¶88¶
	______¶¶¶¶¶____________¶¶¶¶8888¶8¶88881¶8¶888
	_____¶¶¶¶¶8__________8¶¶88¶18818¶88118¶88888¶';
	die($text);
} else {
	$test = strtolower(trim($_GET['test']));
	$sec = trim($_GET['section']);
	$file = trim($_GET['res']);
	$hash = trim($_GET['checksum']);
	
	$root_path = dirname(__DIR__).'/resources/'.$test.'/'.$sec.'/';
	
	if (is_file($root_path.$file) && $hash == md5_file($root_path.$file)) {
		header("Pragma: public");
    	header("Expires: 0");
    	header("Cache-Control: must-revalidate, post-check=0, pre-check=0");
		header('Content-Description: File Transfer');
		header('Content-type: application/octet-stream');
		header('Content-disposition: attachment;filename="'.$file.'"');
		header("Content-Length: ".filesize($root_path.$file));
		header("Content-Transfer-Encoding: binary");
    	readfile($root_path.$file);
		
		http_response_code(200);
	} else {
		http_response_code(404);
		echo json_encode(array('fail'=>true));
	}
}
die;