<?php

if ( !isset($_GET['checksum']) || strlen($_GET['checksum']) !== 32 ){
	$text = "________________1¶¶¶¶¶¶¶¶¶¶¶1________________\r
	_____________¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶1____________\r
	__________¶¶¶¶118¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶___________\r
	_______8¶¶¶¶888¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8________\r
	______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶______\r
	____8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶____\r
	___¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶___\r
	__8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶8¶¶¶¶__\r
	__¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶88881__¶¶¶¶¶¶¶__\r
	_¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶81___________¶¶¶¶¶¶__\r
	1¶¶¶¶¶111____________________________8¶¶¶¶¶¶_\r
	¶¶¶¶¶1___________________________1___1¶¶¶¶¶¶_\r
	¶¶¶¶¶8111___________________________11¶¶¶¶¶¶_\r
	1¶¶¶¶88111__________________________111¶¶¶¶¶_\r
	_¶¶¶¶1881________________________11111_¶¶¶¶¶_\r
	_¶¶¶¶18811_____________________¶¶¶¶¶¶8_1¶¶¶¶1\r
	_¶¶¶¶118¶¶¶¶81______________8¶¶¶¶¶¶¶¶¶_1¶¶¶8¶\r
	_8¶¶881¶¶¶¶¶¶¶¶¶1_________1¶¶¶¶811__1¶811¶¶1¶\r
	¶¶¶¶118¶1__18¶¶¶¶¶8118818¶¶¶88¶111¶888¶11¶¶18\r
	¶8¶¶11¶¶11¶¶111¶¶¶¶¶1___1¶¶¶¶1_1¶__¶¶8888¶¶8_\r
	_1¶¶11¶¶¶¶¶_8¶8_8¶8¶¶____8188__¶¶__¶1__18881_\r
	__8¶88111¶¶_8¶8__1__11___1___111_181___18811_\r
	__11881___181111____11_________________1881__\r
	__118¶81_____________8_________________1881__\r
	___18¶¶1__________1111_____1_11______1_188___\r
	___88¶¶8________88____________8¶81____188____\r
	______1¶1_____8¶888_11____18¶¶118¶8888888____\r
	_______¶¶8881¶¶818¶¶¶¶¶8_1¶¶¶8118¶¶¶¶8888____\r
	_______¶¶¶¶¶¶¶¶881188¶¶¶¶¶¶818¶¶¶¶¶__1888____\r
	_______¶888¶18¶¶¶¶¶8888¶¶¶8¶¶¶¶8_11__88¶_____\r
	______1¶¶8181_118¶¶¶¶¶¶¶¶¶¶¶¶8111___8¶¶______\r
	¶¶¶¶¶¶¶¶¶¶88¶8_1_18¶¶¶¶¶¶¶8881_____1¶8_______\r
	88888¶¶¶¶¶¶¶¶¶8_11118881111_______8¶¶________\r
	88118¶__¶¶8¶8888_1_____________18¶¶_¶¶_______\r
	88888¶___¶¶8818¶¶11_1_______11¶¶¶8__¶¶¶______\r
	¶81¶¶¶____1¶¶¶88¶¶¶88888188¶¶¶¶81__¶¶¶¶¶_____\r
	88¶¶¶8______¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶811__1¶¶¶¶¶¶1____\r
	8¶¶8_________11_1¶¶¶¶¶¶¶888811__¶¶¶¶8¶¶¶¶1___\r
	¶¶8_______¶¶¶¶¶_____11118881__1¶¶¶¶¶¶¶¶¶¶¶___\r
	¶1_______¶¶¶¶¶¶______________¶¶¶¶¶¶¶¶¶8¶¶¶8__\r
	¶_______¶¶¶¶¶¶¶____________1¶¶¶¶¶¶¶8¶¶¶88¶¶8_\r
	_______1¶¶¶¶8_____________¶¶¶¶¶8¶¶¶888888¶¶¶8\r
	_______¶¶¶¶_____________1¶¶¶¶¶88¶¶¶¶¶88¶¶¶88¶\r
	______¶¶¶¶¶____________¶¶¶¶8888¶8¶88881¶8¶888\r
	_____¶¶¶¶¶8__________8¶¶88¶18818¶88118¶88888¶\r";
	die($text);
} else {
	$test = strtolower(trim($_GET['test']));
	$sec = trim($_GET['section']);
	$file = trim($_GET['res']);
	$hash = trim($_GET['checksum']);
	
	$root_path = dirname(__DIR__).'/resources/'.$test.'/'.$sec.'/';
	
	if (is_file($root_path.$file) && $hash == md5_file($root_path.$file)) {
		header("Pragma: public");
    	header("Expires: 0");
    	header("Cache-Control: must-revalidate, post-check=0, pre-check=0");
		header('Content-Description: File Transfer');
		header('Content-type: application/octet-stream');
		header('Content-disposition: attachment;filename="'.$file.'"');
		header("Content-Length: ".filesize($root_path.$file));
		header("Content-Transfer-Encoding: binary");
    	readfile($root_path.$file);
		
		http_response_code(200);
	} else {
		http_response_code(404);
		echo json_encode(array('fail'=>true));
	}
}
die;